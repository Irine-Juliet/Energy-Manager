================================================================================
LOG ACTIVITY FEATURE - REDESIGN IMPLEMENTATION PLAN
Energy Manager Application
================================================================================

Date: 2025-11-17
Version: 2.0 (Redesign based on enhanced user story)

================================================================================
EXECUTIVE SUMMARY
================================================================================

The "Log Activity" feature will be redesigned to provide an intuitive, 
accessible interface for tracking daily activities and their energy impact.
Key enhancements include:
  - Autocomplete activity name field with smart suggestions
  - Duration tracking (hours + minutes)
  - Simplified 1-4 energy rating scale (circular button UI)
  - Enhanced validation and user feedback
  - Case-insensitive activity name consolidation

================================================================================
REFINED USER STORY & ACCEPTANCE CRITERIA
================================================================================

As a user, I want to log daily activities with their details so that I can 
track how different activities affect my energy levels.

ACCEPTANCE CRITERIA:
âœ“ Activity name with autocomplete showing top 5 most frequent activities
âœ“ Filter autocomplete results as user types
âœ“ Empty autocomplete for new users until they start typing
âœ“ Date/time picker (defaults to current date/time)
âœ“ Duration input (hours and minutes, required)
âœ“ Energy impact rating (1-4 scale with circular buttons)
âœ“ Confirmation message on successful save
âœ“ Clear form button
âœ“ All required fields validated before submission

VALIDATION & EDGE CASES:
âœ“ No future dates/times allowed
âœ“ Duration: minimum 1 minute, maximum 24 hours (1440 minutes)
âœ“ Activity name: max 100 characters, case-insensitive matching
âœ“ Duplicate names consolidated using most common casing
âœ“ Clear error messages for missing/invalid fields
âœ“ Overlapping activities allowed

================================================================================
CURRENT STATE ANALYSIS
================================================================================

MODELS (energy_tracker/models.py):
- Activity model exists with:
  - user: ForeignKey to User
  - name: CharField(max_length=200) â€” NEEDS UPDATE to 100
  - description: TextField (optional)
  - energy_level: IntegerField with choices -2 to +2 â€” NEEDS CHANGE to 1-4
  - activity_date: DateTimeField
  - created_at, updated_at: Auto timestamps
- NO duration field â€” NEEDS ADDITION

FORMS (energy_tracker/forms.py):
- ActivityForm exists with basic validation
- Current validation: future date check, energy range check
- NEEDS: autocomplete support, duration fields, updated energy scale

VIEWS (energy_tracker/views.py):
- log_activity_view exists with basic GET/POST handling
- NEEDS: API endpoint for autocomplete suggestions
- NEEDS: Activity name normalization logic
- NEEDS: Success message handling

TEMPLATES (templates/energy_tracker/log_activity.html):
- Current: Complex custom date/time picker UI
- NEEDS: Complete redesign with autocomplete, duration, circular buttons

================================================================================
ARCHITECTURAL DECISIONS
================================================================================

1. DATABASE SCHEMA CHANGES
   Decision: Add duration field; Update energy_level mapping; Limit name to 100 chars
   Rationale: User story requires duration tracking and 1-4 energy scale
   Impact: Requires migration; Existing data needs transformation

2. ENERGY LEVEL MAPPING STRATEGY
   Current: -2 (Very Draining) to +2 (Very Energizing)
   New: 1 (Very Draining) to 4 (Very Energizing)
   Mapping: old_value + 3 = new_value
   Rationale: Simpler for users; aligns with user story
   
3. AUTOCOMPLETE IMPLEMENTATION
   Approach: AJAX endpoint returning JSON with activity suggestions
   Priority: Top 5 by frequency, then alphabetical matches
   Caching: Query optimization with user-specific filtering
   Rationale: Responsive UX without page reload

4. ACTIVITY NAME NORMALIZATION
   Strategy: Case-insensitive lookup with casing consolidation
   Implementation: Store most common casing variant in database
   Edge case: On tie, use most recent casing
   Rationale: Prevents duplicate activities like "Meeting" vs "meeting"

5. DURATION STORAGE
   Format: Store as integer minutes in database
   Display: Separate hour/minute inputs for UX
   Validation: 1 min to 1440 min (24 hours)
   Rationale: Simple storage, flexible display

6. UI FRAMEWORK
   Frontend: Vanilla JavaScript with Tailwind CSS
   No additional libraries needed
   Rationale: Consistent with existing codebase

================================================================================
DETAILED IMPLEMENTATION PLAN
================================================================================

PHASE 1: DATABASE & MODEL UPDATES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1.1 Update Activity Model (energy_tracker/models.py)
    
    Changes Required:
    - Add duration field: PositiveIntegerField (minutes, default=60)
    - Update name field: max_length=200 â†’ max_length=100
    - Update ENERGY_CHOICES: Map to 1-4 scale
      - (1, 'Very Draining')
      - (2, 'Somewhat Draining')
      - (3, 'Somewhat Energizing')
      - (4, 'Very Energizing')
    - Add helper method: get_duration_display() returns "Xh Ym"
    - Update __str__ method to include duration
    
    Validation:
    - duration: MinValueValidator(1), MaxValueValidator(1440)
    
    Migration Strategy:
    - Create migration with duration field (default=60 for existing records)
    - Create data migration to transform energy_level: old_value + 3
    - Test on copy of production data before deployment

1.2 Create Database Migration
    
    Commands:
    ```
    python manage.py makemigrations energy_tracker
    python manage.py migrate energy_tracker
    ```
    
    Verify:
    - Check migration file for correct field definitions
    - Test rollback capability
    - Ensure no data loss

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 2: BACKEND LOGIC & API
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2.1 Update ActivityForm (energy_tracker/forms.py)
    
    New Fields:
    - duration_hours: IntegerField(min_value=0, max_value=24, required=True)
    - duration_minutes: IntegerField(min_value=0, max_value=59, required=True)
    - Remove: description field (per user story simplification)
    
    Widget Updates:
    - name: TextInput with autocomplete attributes
      - Add: id="activityNameInput", autocomplete="off"
      - Add: data-autocomplete-url for JS
    - energy_level: Custom widget for circular buttons
      - Use RadioSelect but style as circular buttons
    - activity_date: Keep datetime-local input
    
    Validation Methods:
    - clean_activity_date(): Reject future dates/times
    - clean_name(): 
      - Max 100 characters
      - Strip whitespace
      - Case-insensitive duplicate check
    - clean(): 
      - Calculate total duration = hours*60 + minutes
      - Validate: 1 â‰¤ total_duration â‰¤ 1440
      - Convert duration to minutes for storage
    
    Error Messages:
    - Future date: "Cannot log activities in the future"
    - Duration too short: "Activity must be at least 1 minute"
    - Duration too long: "Activity cannot exceed 24 hours"
    - Missing name: "Activity name is required"
    - Invalid energy: "Please select an energy level"

2.2 Activity Name Normalization Helper (energy_tracker/utils.py - NEW FILE)
    
    Function: get_canonical_activity_name(user, name_input)
    Purpose: Return the most common casing for an activity name
    
    Algorithm:
    1. Query all user's activities with name__iexact=name_input
    2. Group by exact name (case-sensitive)
    3. Count occurrences of each casing variant
    4. Return most common casing (or most recent on tie)
    5. If no match, return name_input.strip()
    
    Usage: Called before saving new Activity to normalize casing

2.3 Autocomplete API Endpoint (energy_tracker/views.py)
    
    New View: autocomplete_activities_view(request)
    URL: /autocomplete-activities/
    Method: GET
    Parameters: ?q=<search_term>
    
    Logic:
    1. Get search term from query params (min 1 character)
    2. Query user's activities:
       - Case-insensitive name contains search term
       - Group by normalized name
       - Annotate with count
    3. Get top 5 by frequency
    4. If fewer than 5, add alphabetical matches up to 5 total
    5. Return JSON: [{"name": "Meeting", "count": 15}, ...]
    
    Response Format:
    ```json
    {
      "suggestions": [
        {"name": "Team Meeting", "count": 42, "is_top_5": true},
        {"name": "Exercise", "count": 38, "is_top_5": true},
        {"name": "Coding", "count": 35, "is_top_5": true},
        {"name": "Email", "count": 30, "is_top_5": true},
        {"name": "Planning", "count": 28, "is_top_5": true}
      ]
    }
    ```
    
    Optimization:
    - Cache top 5 for 5 minutes per user
    - Index on (user, name) for fast lookups
    - Limit query results to prevent DoS

2.4 Update log_activity_view (energy_tracker/views.py)
    
    GET Request:
    - Initialize form with current datetime
    - Pass empty form to template
    
    POST Request:
    1. Validate form
    2. If valid:
       a. Create activity (commit=False)
       b. Set user = request.user
       c. Normalize activity name using helper
       d. Calculate duration from hours + minutes
       e. Set activity_date (default to now if empty)
       f. Save to database
       g. Create success message with activity details
       h. Return JSON response (for AJAX) or redirect with message
    3. If invalid:
       a. Return form with errors (JSON or HTML)
       b. Preserve user input
    
    POST-SUBMIT FLOW (Critical):
    After successful activity submission:
    1. Show success toast/message with activity details
    2. Automatically clear the form to default state
    3. Keep user on the same page (NO redirect)
    4. Reset form to current date/time and default values
    5. User can immediately log another activity
    
    Success Message Format:
    - Use Django messages framework
    - Display as toast notification: "Activity logged successfully!"
    - Include: Activity name, duration, energy level
    - Example: "Team Meeting â€¢ 2h 30m â€¢ Very Energizing"
    - Auto-dismiss after 3 seconds
    - User can manually dismiss
    
    Implementation Options:
    Option A (AJAX - Recommended):
    - Form submits via AJAX/fetch
    - Return JSON response: {"success": true, "activity": {...}}
    - JavaScript handles success toast and form reset
    - No page reload, smooth UX
    
    Option B (Traditional POST):
    - Form submits normally
    - Redirect back to log_activity page with success message
    - JavaScript detects message and shows toast
    - Form auto-resets on page load
    
    Recommendation: Use Option A (AJAX) for better UX
    
    Error Handling:
    - Catch validation errors
    - Display field-specific errors inline
    - Display non-field errors at top of form

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 3: FRONTEND IMPLEMENTATION (COMPLETE REDESIGN)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

IMPORTANT: This is a COMPLETE REWRITE of the log_activity.html template.
NO existing frontend code will be reused. All JavaScript, HTML structure, and
styling will be built from scratch according to the new design specifications.

3.1 Template Structure (templates/energy_tracker/log_activity.html)
    
    Complete Redesign Approach:
    - Delete all existing HTML/CSS/JavaScript in the template
    - Build new clean, semantic HTML structure
    - Implement modern, accessible form design
    - Use vanilla JavaScript (no jQuery or existing scripts)
    - Focus on simplicity and user experience
    
    New Layout:
    ```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â† Back to Dashboard                        â”‚
    â”‚                                             â”‚
    â”‚  Log New Activity                           â”‚
    â”‚  Track how this activity affected your      â”‚
    â”‚  energy levels                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                             â”‚
    â”‚  Activity Name *                            â”‚
    â”‚  [_____________________________] [ğŸ”]       â”‚
    â”‚  â†“ Autocomplete suggestions appear here    â”‚
    â”‚                                             â”‚
    â”‚  When did this happen? *                    â”‚
    â”‚  [Date: MM/DD/YYYY â–¼] [Time: HH:MM AM/PM â–¼]â”‚
    â”‚                                             â”‚
    â”‚  How long did it last? *                    â”‚
    â”‚  [__] hours  [__] minutes                   â”‚
    â”‚                                             â”‚
    â”‚  Energy Impact *                            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”              â”‚
    â”‚  â”‚ ğŸ˜« â”‚ â”‚ ğŸ˜” â”‚ â”‚ ğŸ˜Š â”‚ â”‚ ğŸš€ â”‚              â”‚
    â”‚  â”‚  1 â”‚ â”‚  2 â”‚ â”‚  3 â”‚ â”‚  4 â”‚              â”‚
    â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜              â”‚
    â”‚  Very    Some-  Some-   Very               â”‚
    â”‚  Drain   what   what    Ener               â”‚
    â”‚  ing     Drain  Ener    gizing             â”‚
    â”‚                 gizing                      â”‚
    â”‚                                             â”‚
    â”‚         [Clear Form]  [Log Activity]        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```
    
    HTML Structure (BRAND NEW):
    ```html
    {% extends "base.html" %}
    {% block title %}Log Activity - Energy Manager{% endblock %}
    {% block content %}
    <div class="min-h-screen bg-gray-50 py-8 px-4">
      <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mb-6">
          <a href="{% url 'dashboard' %}" class="text-indigo-600 hover:text-indigo-800 flex items-center gap-2">
            â† Back to Dashboard
          </a>
        </div>
        
        <!-- Main Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
          <!-- Title Section -->
          <div class="px-8 py-6 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
            <h1 class="text-3xl font-bold text-gray-900">Log New Activity</h1>
            <p class="mt-2 text-gray-600">Track how this activity affected your energy levels</p>
          </div>
          
          <!-- Form Section -->
          <form method="post" id="activityForm" class="px-8 py-6 space-y-6" novalidate>
            {% csrf_token %}
            
            <!-- Activity Name with Autocomplete -->
            <!-- Date/Time Pickers -->
            <!-- Duration Inputs -->
            <!-- Energy Impact Buttons -->
            <!-- Action Buttons -->
          </form>
        </div>
        
        <!-- Success Modal (hidden by default) -->
        <div id="successModal" class="hidden">
          <!-- Modal content -->
        </div>
      </div>
    </div>
    {% endblock %}
    ```
    
    Note: The "Success Modal" comment above should be "Success Toast" - 
    the actual implementation uses a toast notification, not a modal.
    
    Form Elements (ALL NEW):
    
    1. Activity Name with Autocomplete:
       ```html
       <div class="form-group">
         <label for="activityName" class="block text-sm font-semibold text-gray-700 mb-2">
           Activity Name <span class="text-red-500">*</span>
         </label>
         <div class="relative">
           <input 
             type="text" 
             id="activityName" 
             name="name"
             maxlength="100"
             autocomplete="off"
             class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
             placeholder="e.g., Team Meeting, Exercise, Coding"
             aria-describedby="activityNameHelp activityNameError"
           />
           <div class="absolute right-3 top-3 text-gray-400">
             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
             </svg>
           </div>
           <!-- Autocomplete Dropdown -->
           <div id="autocompleteDropdown" class="absolute z-50 w-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 hidden max-h-64 overflow-y-auto">
             <!-- Populated by JavaScript -->
           </div>
         </div>
         <p id="activityNameHelp" class="mt-1 text-xs text-gray-500">
           Start typing to see suggestions from your previous activities
         </p>
         <p id="activityNameError" class="mt-1 text-xs text-red-600 hidden" role="alert"></p>
       </div>
       ```
    
    2. Date/Time Pickers (SIMPLIFIED - Native HTML5):
       ```html
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <!-- Date Picker -->
         <div class="form-group">
           <label for="activityDate" class="block text-sm font-semibold text-gray-700 mb-2">
             Date <span class="text-red-500">*</span>
           </label>
           <input 
             type="date" 
             id="activityDate" 
             name="activity_date_date"
             class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
             aria-describedby="activityDateError"
           />
           <p id="activityDateError" class="mt-1 text-xs text-red-600 hidden" role="alert"></p>
         </div>
         
         <!-- Time Picker -->
         <div class="form-group">
           <label for="activityTime" class="block text-sm font-semibold text-gray-700 mb-2">
             Time <span class="text-red-500">*</span>
           </label>
           <input 
             type="time" 
             id="activityTime" 
             name="activity_date_time"
             class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
             aria-describedby="activityTimeError"
           />
           <p id="activityTimeError" class="mt-1 text-xs text-red-600 hidden" role="alert"></p>
         </div>
       </div>
       <!-- Hidden field for Django form -->
       <input type="hidden" id="activity_date" name="activity_date" />
       ```
    
    3. Duration Inputs:
       ```html
       <div class="form-group">
         <label class="block text-sm font-semibold text-gray-700 mb-2">
           How long did it last? <span class="text-red-500">*</span>
         </label>
         <div class="flex items-center gap-4">
           <div class="flex-1">
             <input 
               type="number" 
               id="durationHours" 
               name="duration_hours"
               min="0" 
               max="24" 
               value="0"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
               aria-label="Hours"
             />
             <span class="block text-xs text-gray-500 mt-1">hours</span>
           </div>
           <div class="flex-1">
             <input 
               type="number" 
               id="durationMinutes" 
               name="duration_minutes"
               min="0" 
               max="59" 
               value="0"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
               aria-label="Minutes"
             />
             <span class="block text-xs text-gray-500 mt-1">minutes</span>
           </div>
         </div>
         <p class="mt-2 text-xs text-gray-500">Duration must be between 1 minute and 24 hours</p>
         <p id="durationError" class="mt-1 text-xs text-red-600 hidden" role="alert"></p>
       </div>
       ```
    
    4. Energy Impact Circular Buttons (BRAND NEW DESIGN):
       ```html
       <div class="form-group">
         <label class="block text-sm font-semibold text-gray-700 mb-3">
           Energy Impact <span class="text-red-500">*</span>
         </label>
         <div class="grid grid-cols-4 gap-3" role="radiogroup" aria-label="Energy Impact">
           <!-- Button 1: Very Draining -->
           <button 
             type="button" 
             class="energy-btn" 
             data-value="1"
             aria-label="Very Draining"
           >
             <div class="energy-btn-inner bg-red-50 hover:bg-red-100 border-2 border-red-200 hover:border-red-400 text-red-700">
               <span class="text-4xl">ğŸ˜«</span>
               <span class="text-2xl font-bold">1</span>
               <span class="text-xs leading-tight">Very<br/>Draining</span>
             </div>
           </button>
           
           <!-- Button 2: Somewhat Draining -->
           <button 
             type="button" 
             class="energy-btn" 
             data-value="2"
             aria-label="Somewhat Draining"
           >
             <div class="energy-btn-inner bg-orange-50 hover:bg-orange-100 border-2 border-orange-200 hover:border-orange-400 text-orange-700">
               <span class="text-4xl">ğŸ˜”</span>
               <span class="text-2xl font-bold">2</span>
               <span class="text-xs leading-tight">Somewhat<br/>Draining</span>
             </div>
           </button>
           
           <!-- Button 3: Somewhat Energizing -->
           <button 
             type="button" 
             class="energy-btn" 
             data-value="3"
             aria-label="Somewhat Energizing"
           >
             <div class="energy-btn-inner bg-green-50 hover:bg-green-100 border-2 border-green-200 hover:border-green-400 text-green-700">
               <span class="text-4xl">ğŸ˜Š</span>
               <span class="text-2xl font-bold">3</span>
               <span class="text-xs leading-tight">Somewhat<br/>Energizing</span>
             </div>
           </button>
           
           <!-- Button 4: Very Energizing -->
           <button 
             type="button" 
             class="energy-btn" 
             data-value="4"
             aria-label="Very Energizing"
           >
             <div class="energy-btn-inner bg-emerald-50 hover:bg-emerald-100 border-2 border-emerald-200 hover:border-emerald-400 text-emerald-700">
               <span class="text-4xl">ğŸš€</span>
               <span class="text-2xl font-bold">4</span>
               <span class="text-xs leading-tight">Very<br/>Energizing</span>
             </div>
           </button>
         </div>
         <input type="hidden" id="energy_level" name="energy_level" />
         <p id="energyError" class="mt-2 text-xs text-red-600 hidden" role="alert"></p>
       </div>
       ```
    
    5. Action Buttons:
       ```html
       <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
         <button 
           type="button" 
           id="clearFormBtn"
           class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition"
         >
           Clear Form
         </button>
         <button 
           type="submit"
           class="flex-1 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition shadow-sm"
         >
           Log Activity
         </button>
       </div>
       ```

3.2 Success Modal (BRAND NEW)
    
    Note: This is now a SUCCESS TOAST, not a modal, to keep user on page
    
    HTML Structure:
    ```html
    <!-- Success Toast (hidden by default, appears at top-right) -->
    <div id="successToast" class="fixed top-4 right-4 z-50 hidden transform transition-all duration-300 ease-out" role="alert" aria-live="polite" aria-atomic="true">
      <div class="bg-white rounded-lg shadow-xl border-l-4 border-green-500 p-4 max-w-md">
        <div class="flex items-start gap-3">
          <!-- Checkmark Icon -->
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          
          <!-- Message Content -->
          <div class="flex-1 pt-0.5">
            <h3 class="text-sm font-semibold text-gray-900">Activity Logged!</h3>
            <p id="successToastMessage" class="mt-1 text-sm text-gray-600">
              <!-- Populated by JavaScript: "Team Meeting â€¢ 2h 30m â€¢ Very Energizing" -->
            </p>
          </div>
          
          <!-- Close Button -->
          <button 
            id="closeSuccessToast" 
            class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition"
            aria-label="Close"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    ```
    
    Toast Behavior:
    - Appears at top-right of screen (fixed position)
    - Slides in from right with animation
    - Auto-dismisses after 3 seconds
    - User can manually close by clicking X
    - Does NOT block page interaction (unlike modal)
    - Multiple toasts stack vertically if needed

3.4 Additional CSS for Energy Buttons (Tailwind Custom Classes)
    
    Add to template's <style> tag if needed for animations:
    ```css
    <style>
    /* Energy Button Transitions */
    .energy-btn {
      transition: transform 0.2s ease;
    }
    
    .energy-btn:hover {
      transform: scale(1.05);
    }
    
    .energy-btn:active {
      transform: scale(0.98);
    }
    
    .energy-btn-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      border-radius: 1rem;
      transition: all 0.2s ease;
      min-height: 140px;
    }
    
    /* Toast Slide-in Animation */
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    #successToast:not(.hidden) {
      animation: slideInRight 0.3s ease-out;
    }
    
    #successToast.hiding {
      animation: slideOutRight 0.3s ease-out;
    }
    
    /* Checkmark Animation */
    @keyframes checkmark {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    #successToast:not(.hidden) svg {
      animation: checkmark 0.4s ease-out 0.1s both;
    }
    </style>
    ```

3.5 Complete JavaScript Implementation (BRAND NEW - NO REUSE)
    
    File: Inline <script> tag at bottom of template
    
    FULL JavaScript Code Structure:
    ```javascript
    <script>
    // ============================================================================
    // ENERGY MANAGER - LOG ACTIVITY FORM
    // Complete JavaScript implementation from scratch
    // ============================================================================
    
    (function() {
      'use strict';
      
      // ========================================
      // DOM Elements
      // ========================================
      const form = document.getElementById('activityForm');
      const activityNameInput = document.getElementById('activityName');
      const autocompleteDropdown = document.getElementById('autocompleteDropdown');
      const activityDateInput = document.getElementById('activityDate');
      const activityTimeInput = document.getElementById('activityTime');
      const hiddenDateTimeInput = document.getElementById('activity_date');
      const durationHoursInput = document.getElementById('durationHours');
      const durationMinutesInput = document.getElementById('durationMinutes');
      const energyButtons = document.querySelectorAll('.energy-btn');
      const energyLevelInput = document.getElementById('energy_level');
      const clearFormBtn = document.getElementById('clearFormBtn');
      const successToast = document.getElementById('successToast');
      
      // Error message elements
      const activityNameError = document.getElementById('activityNameError');
      const activityDateError = document.getElementById('activityDateError');
      const activityTimeError = document.getElementById('activityTimeError');
      const durationError = document.getElementById('durationError');
      const energyError = document.getElementById('energyError');
      
      // ========================================
      // State Management
      // ========================================
      let selectedEnergyLevel = null;
      let autocompleteTimeout = null;
      let highlightedIndex = -1;
      let suggestions = [];
      
      // ========================================
      // Initialization
      // ========================================
      function init() {
        setCurrentDateTime();
        attachEventListeners();
        setupAccessibility();
      }
      
      // ========================================
      // Date/Time Utilities
      // ========================================
      function setCurrentDateTime() {
        const now = new Date();
        
        // Set date (YYYY-MM-DD format)
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        activityDateInput.value = `${year}-${month}-${day}`;
        
        // Set time (HH:MM format)
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        activityTimeInput.value = `${hours}:${minutes}`;
        
        // Set max date to today
        activityDateInput.max = `${year}-${month}-${day}`;
        
        updateHiddenDateTime();
      }
      
      function updateHiddenDateTime() {
        const date = activityDateInput.value;
        const time = activityTimeInput.value;
        if (date && time) {
          hiddenDateTimeInput.value = `${date}T${time}`;
        }
      }
      
      function validateDateTime() {
        const selectedDateTime = new Date(activityDateInput.value + 'T' + activityTimeInput.value);
        const now = new Date();
        
        if (selectedDateTime > now) {
          showError(activityDateError, 'Cannot log activities in the future');
          return false;
        }
        
        hideError(activityDateError);
        return true;
      }
      
      // ========================================
      // Autocomplete Functionality
      // ========================================
      function handleAutocompleteInput(e) {
        const searchTerm = e.target.value.trim();
        
        // Clear timeout to implement debouncing
        clearTimeout(autocompleteTimeout);
        
        if (searchTerm.length === 0) {
          hideAutocomplete();
          return;
        }
        
        // Debounce: wait 300ms after user stops typing
        autocompleteTimeout = setTimeout(() => {
          fetchSuggestions(searchTerm);
        }, 300);
      }
      
      async function fetchSuggestions(searchTerm) {
        try {
          const response = await fetch(`/autocomplete-activities/?q=${encodeURIComponent(searchTerm)}`);
          
          if (!response.ok) throw new Error('Failed to fetch suggestions');
          
          const data = await response.json();
          suggestions = data.suggestions || [];
          renderSuggestions();
        } catch (error) {
          console.error('Autocomplete error:', error);
          suggestions = [];
          hideAutocomplete();
        }
      }
      
      function renderSuggestions() {
        autocompleteDropdown.innerHTML = '';
        
        if (suggestions.length === 0) {
          const noResults = document.createElement('div');
          noResults.className = 'px-4 py-3 text-sm text-gray-500 text-center';
          noResults.textContent = 'No matching activities found';
          autocompleteDropdown.appendChild(noResults);
          showAutocomplete();
          return;
        }
        
        suggestions.forEach((suggestion, index) => {
          const item = document.createElement('div');
          item.className = 'px-4 py-3 cursor-pointer hover:bg-indigo-50 transition flex items-center justify-between group';
          item.setAttribute('data-index', index);
          item.setAttribute('role', 'option');
          
          const nameContainer = document.createElement('div');
          nameContainer.className = 'flex items-center gap-2';
          
          if (suggestion.is_top_5) {
            const badge = document.createElement('span');
            badge.textContent = 'â­';
            badge.className = 'text-sm';
            badge.title = 'Frequently used';
            nameContainer.appendChild(badge);
          }
          
          const name = document.createElement('span');
          name.className = 'text-gray-900 font-medium';
          name.textContent = suggestion.name;
          nameContainer.appendChild(name);
          
          const count = document.createElement('span');
          count.className = 'text-xs text-gray-500';
          count.textContent = `${suggestion.count} times`;
          
          item.appendChild(nameContainer);
          item.appendChild(count);
          
          item.addEventListener('click', () => selectSuggestion(suggestion.name));
          item.addEventListener('mouseenter', () => highlightSuggestion(index));
          
          autocompleteDropdown.appendChild(item);
        });
        
        showAutocomplete();
        highlightedIndex = -1;
      }
      
      function selectSuggestion(name) {
        activityNameInput.value = name;
        hideAutocomplete();
        activityDateInput.focus();
      }
      
      function highlightSuggestion(index) {
        const items = autocompleteDropdown.querySelectorAll('[data-index]');
        items.forEach((item, i) => {
          if (i === index) {
            item.classList.add('bg-indigo-50');
            item.setAttribute('aria-selected', 'true');
          } else {
            item.classList.remove('bg-indigo-50');
            item.setAttribute('aria-selected', 'false');
          }
        });
        highlightedIndex = index;
      }
      
      function handleAutocompleteKeyboard(e) {
        if (!autocompleteDropdown.classList.contains('hidden')) {
          if (e.key === 'ArrowDown') {
            e.preventDefault();
            const newIndex = Math.min(highlightedIndex + 1, suggestions.length - 1);
            highlightSuggestion(newIndex);
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const newIndex = Math.max(highlightedIndex - 1, 0);
            highlightSuggestion(newIndex);
          } else if (e.key === 'Enter') {
            e.preventDefault();
            if (highlightedIndex >= 0 && highlightedIndex < suggestions.length) {
              selectSuggestion(suggestions[highlightedIndex].name);
            }
          } else if (e.key === 'Escape') {
            hideAutocomplete();
          }
        }
      }
      
      function showAutocomplete() {
        autocompleteDropdown.classList.remove('hidden');
        autocompleteDropdown.setAttribute('aria-expanded', 'true');
      }
      
      function hideAutocomplete() {
        autocompleteDropdown.classList.add('hidden');
        autocompleteDropdown.setAttribute('aria-expanded', 'false');
        highlightedIndex = -1;
      }
      
      // ========================================
      // Energy Level Selection
      // ========================================
      function handleEnergyButtonClick(e) {
        e.preventDefault();
        const button = e.currentTarget;
        const value = button.getAttribute('data-value');
        
        // Remove selected state from all buttons
        energyButtons.forEach(btn => {
          const inner = btn.querySelector('.energy-btn-inner');
          inner.classList.remove('ring-4', 'ring-offset-2');
          
          // Remove color-specific rings
          inner.classList.remove('ring-red-400', 'ring-orange-400', 'ring-green-400', 'ring-emerald-400');
        });
        
        // Add selected state to clicked button
        const inner = button.querySelector('.energy-btn-inner');
        inner.classList.add('ring-4', 'ring-offset-2');
        
        // Add color-specific ring based on value
        const ringColors = {
          '1': 'ring-red-400',
          '2': 'ring-orange-400',
          '3': 'ring-green-400',
          '4': 'ring-emerald-400'
        };
        inner.classList.add(ringColors[value]);
        
        // Update hidden input and state
        selectedEnergyLevel = value;
        energyLevelInput.value = value;
        hideError(energyError);
      }
      
      // ========================================
      // Form Validation
      // ========================================
      function validateForm() {
        let isValid = true;
        
        // Validate activity name
        const activityName = activityNameInput.value.trim();
        if (!activityName) {
          showError(activityNameError, 'Activity name is required');
          isValid = false;
        } else if (activityName.length > 100) {
          showError(activityNameError, 'Activity name cannot exceed 100 characters');
          isValid = false;
        } else {
          hideError(activityNameError);
        }
        
        // Validate date/time
        if (!validateDateTime()) {
          isValid = false;
        }
        
        // Validate duration
        const hours = parseInt(durationHoursInput.value) || 0;
        const minutes = parseInt(durationMinutesInput.value) || 0;
        const totalMinutes = hours * 60 + minutes;
        
        if (totalMinutes < 1) {
          showError(durationError, 'Activity must be at least 1 minute');
          isValid = false;
        } else if (totalMinutes > 1440) {
          showError(durationError, 'Activity cannot exceed 24 hours');
          isValid = false;
        } else {
          hideError(durationError);
        }
        
        // Validate energy level
        if (!selectedEnergyLevel) {
          showError(energyError, 'Please select an energy level');
          isValid = false;
        } else {
          hideError(energyError);
        }
        
        return isValid;
      }
      
      function showError(element, message) {
        element.textContent = message;
        element.classList.remove('hidden');
        
        // Add red border to associated input
        const inputId = element.id.replace('Error', '');
        const input = document.getElementById(inputId);
        if (input) {
          input.classList.add('border-red-500', 'focus:ring-red-500');
        }
      }
      
      function hideError(element) {
        element.textContent = '';
        element.classList.add('hidden');
        
        // Remove red border from associated input
        const inputId = element.id.replace('Error', '');
        const input = document.getElementById(inputId);
        if (input) {
          input.classList.remove('border-red-500', 'focus:ring-red-500');
        }
      }
      
      // ========================================
      // Form Submission
      // ========================================
      function handleFormSubmit(e) {
        e.preventDefault(); // Always prevent default to handle via AJAX
        
        // Update hidden datetime field
        updateHiddenDateTime();
        
        // Validate form
        if (!validateForm()) {
          // Scroll to first error
          const firstError = document.querySelector('.text-red-600:not(.hidden)');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          return false;
        }
        
        // Form is valid, submit via AJAX
        submitFormViaAjax();
      }
      
      async function submitFormViaAjax() {
        try {
          const formData = new FormData(form);
          
          const response = await fetch(form.action || window.location.href, {
            method: 'POST',
            body: formData,
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            }
          });
          
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          
          const result = await response.json();
          
          if (result.success) {
            // SUCCESS: Show toast, clear form, stay on page
            const activityName = activityNameInput.value.trim();
            const hours = parseInt(durationHoursInput.value) || 0;
            const minutes = parseInt(durationMinutesInput.value) || 0;
            const duration = formatDuration(hours, minutes);
            
            showSuccessToast(activityName, duration, selectedEnergyLevel);
            resetFormToDefaults();
          } else {
            // Server returned validation errors
            displayServerErrors(result.errors);
          }
        } catch (error) {
          console.error('Form submission error:', error);
          alert('An error occurred while saving the activity. Please try again.');
        }
      }
      
      function formatDuration(hours, minutes) {
        const parts = [];
        if (hours > 0) parts.push(`${hours}h`);
        if (minutes > 0) parts.push(`${minutes}m`);
        return parts.join(' ') || '0m';
      }
      
      function resetFormToDefaults() {
        // Reset all fields to initial state
        activityNameInput.value = '';
        setCurrentDateTime();
        durationHoursInput.value = '0';
        durationMinutesInput.value = '0';
        
        // Deselect all energy buttons
        energyButtons.forEach(btn => {
          const inner = btn.querySelector('.energy-btn-inner');
          inner.classList.remove('ring-4', 'ring-offset-2', 'ring-red-400', 'ring-orange-400', 'ring-green-400', 'ring-emerald-400');
        });
        selectedEnergyLevel = null;
        energyLevelInput.value = '';
        
        // Clear all errors
        hideError(activityNameError);
        hideError(activityDateError);
        hideError(activityTimeError);
        hideError(durationError);
        hideError(energyError);
        
        // Hide autocomplete
        hideAutocomplete();
        
        // Focus on activity name input for next entry
        activityNameInput.focus();
      }
      
      function displayServerErrors(errors) {
        // Display server-side validation errors
        if (errors.name) showError(activityNameError, errors.name[0]);
        if (errors.activity_date) showError(activityDateError, errors.activity_date[0]);
        if (errors.duration_hours || errors.duration_minutes) {
          showError(durationError, errors.duration_hours?.[0] || errors.duration_minutes?.[0]);
        }
        if (errors.energy_level) showError(energyError, errors.energy_level[0]);
      }
      
      // ========================================
      // Clear Form
      // ========================================
      function handleClearForm(e) {
        e.preventDefault();
        
        // Check if form has any data
        const hasData = activityNameInput.value.trim() ||
                       durationHoursInput.value !== '0' ||
                       durationMinutesInput.value !== '0' ||
                       selectedEnergyLevel;
        
        if (hasData) {
          const confirmed = confirm('Are you sure you want to clear all form fields?');
          if (!confirmed) return;
        }
        
        // Reset all fields
        activityNameInput.value = '';
        setCurrentDateTime();
        durationHoursInput.value = '0';
        durationMinutesInput.value = '0';
        
        // Deselect all energy buttons
        energyButtons.forEach(btn => {
          const inner = btn.querySelector('.energy-btn-inner');
          inner.classList.remove('ring-4', 'ring-offset-2', 'ring-red-400', 'ring-orange-400', 'ring-green-400', 'ring-emerald-400');
        });
        selectedEnergyLevel = null;
        energyLevelInput.value = '';
        
        // Clear all errors
        hideError(activityNameError);
        hideError(activityDateError);
        hideError(activityTimeError);
        hideError(durationError);
        hideError(energyError);
        
        // Hide autocomplete
        hideAutocomplete();
        
        // Focus on activity name input
        activityNameInput.focus();
      }
      
      // ========================================
      // Success Toast
      // ========================================
      function showSuccessToast(activityName, duration, energyLevel) {
        const message = document.getElementById('successToastMessage');
        
        const energyLabels = {
          '1': 'Very Draining',
          '2': 'Somewhat Draining',
          '3': 'Somewhat Energizing',
          '4': 'Very Energizing'
        };
        
        message.textContent = `${activityName} â€¢ ${duration} â€¢ ${energyLabels[energyLevel]}`;
        
        // Show toast with animation
        successToast.classList.remove('hidden', 'hiding');
        
        // Auto-dismiss after 3 seconds
        setTimeout(() => {
          hideSuccessToast();
        }, 3000);
      }
      
      function hideSuccessToast() {
        // Add hiding class for slide-out animation
        successToast.classList.add('hiding');
        
        // After animation completes, hide the element
        setTimeout(() => {
          successToast.classList.add('hidden');
          successToast.classList.remove('hiding');
        }, 300);
      }
      
      // ========================================
      // Event Listeners
      // ========================================
      function attachEventListeners() {
        // Autocomplete
        activityNameInput.addEventListener('input', handleAutocompleteInput);
        activityNameInput.addEventListener('keydown', handleAutocompleteKeyboard);
        activityNameInput.addEventListener('focus', () => {
          if (activityNameInput.value.trim()) {
            handleAutocompleteInput({ target: activityNameInput });
          }
        });
        
        // Date/Time
        activityDateInput.addEventListener('change', updateHiddenDateTime);
        activityTimeInput.addEventListener('change', updateHiddenDateTime);
        activityDateInput.addEventListener('blur', validateDateTime);
        activityTimeInput.addEventListener('blur', validateDateTime);
        
        // Energy buttons
        energyButtons.forEach(btn => {
          btn.addEventListener('click', handleEnergyButtonClick);
        });
        
        // Clear form button
        clearFormBtn.addEventListener('click', handleClearForm);
        
        // Form submission
        form.addEventListener('submit', handleFormSubmit);
        
        // Success toast close button
        const closeToastBtn = document.getElementById('closeSuccessToast');
        if (closeToastBtn) {
          closeToastBtn.addEventListener('click', hideSuccessToast);
        }
        
        // Close autocomplete when clicking outside
        document.addEventListener('click', (e) => {
          if (!activityNameInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
            hideAutocomplete();
          }
        });
      }
      
      // ========================================
      // Accessibility
      // ========================================
      function setupAccessibility() {
        // Set ARIA attributes
        activityNameInput.setAttribute('aria-autocomplete', 'list');
        activityNameInput.setAttribute('aria-controls', 'autocompleteDropdown');
        autocompleteDropdown.setAttribute('role', 'listbox');
        
        // Add character counter for activity name
        activityNameInput.addEventListener('input', () => {
          const charCount = activityNameInput.value.length;
          const helpText = document.getElementById('activityNameHelp');
          if (charCount > 0) {
            helpText.textContent = `${charCount}/100 characters`;
          } else {
            helpText.textContent = 'Start typing to see suggestions from your previous activities';
          }
        });
      }
      
      // ========================================
      // Check for Django messages and show toast
      // ========================================
      function checkDjangoMessages() {
        // This function is no longer needed since we're using AJAX
        // Keeping for backward compatibility if needed
        // All success handling is now done via AJAX response
      }
      
      // ========================================
      // Initialize on DOM ready
      // ========================================
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
    })();
    </script>
    ```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 4: VALIDATION & ERROR HANDLING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CRITICAL: POST-SUBMIT FLOW SPECIFICATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

After User Submits Activity Form:

1. VALIDATION (Client-Side First)
   - JavaScript validates all fields before submission
   - If validation fails: Show inline errors, scroll to first error, STOP
   - If validation passes: Proceed to AJAX submission

2. AJAX SUBMISSION
   - Form submits via fetch() API to Django backend
   - Django validates and saves activity
   - Django returns JSON response: {success: true/false, errors: {...}}

3. SUCCESS PATH (if Django returns success: true)
   Step 1: Show success toast notification
           - Toast slides in from right side
           - Contains: Activity name â€¢ Duration â€¢ Energy level
           - Example: "Team Meeting â€¢ 2h 30m â€¢ Very Energizing"
           - Positioned at top-right, doesn't block page
   
   Step 2: Clear form to default state
           - Activity name: empty
           - Date/Time: reset to current date/time
           - Duration: reset to 0h 0m
           - Energy level: deselected
           - All errors: cleared
   
   Step 3: Keep user on page (NO redirect)
           - User stays on log activity page
           - Toast auto-dismisses after 3 seconds
           - User can immediately log another activity
   
   Step 4: Focus on activity name input
           - Cursor ready for next entry
           - Seamless multi-activity logging experience

4. ERROR PATH (if Django returns success: false)
   - Display server-side validation errors inline
   - Preserve user input (don't clear form)
   - User can correct and resubmit

5. NETWORK ERROR PATH
   - Show alert: "An error occurred. Please try again."
   - Preserve user input
   - User can retry submission

KEY BENEFITS OF THIS FLOW:
âœ“ No page reload = faster, smoother UX
âœ“ No redirect = user stays in context
âœ“ Auto-reset form = quick consecutive entries
âœ“ Toast notification = non-intrusive feedback
âœ“ Immediate readiness = log multiple activities quickly

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4.1 Client-Side Validation (JavaScript)
    
    Pre-Submit Checks:
    - Activity name: Not empty, max 100 chars
    - Date/time: Not in future
    - Duration: Hours and minutes not both zero
    - Energy level: One button selected
    
    Error Display:
    - Inline errors below each field (red text)
    - Scroll to first error
    - Focus on error field
    
    Real-Time Validation:
    - Activity name: Show character count (X/100)
    - Duration: Show total minutes as you type
    - Date/time: Highlight if future date selected

4.2 Server-Side Validation (Django Form)
    
    All validations from 2.1 applied on server
    
    Error Response:
    - Return form with errors
    - Preserve user input
    - Display errors in template
    
    Edge Cases:
    - Duplicate name (different casing): Consolidate to canonical form
    - Timezone issues: Handle aware/naive datetimes
    - Duration edge: Accept exactly 1 min and exactly 1440 min
    - Empty autocomplete: Allow manual entry

4.3 Error Message UX
    
    Principles:
    - Be specific: "Duration must be at least 1 minute" not "Invalid duration"
    - Be helpful: Suggest correction where possible
    - Be visible: Red border + icon + text message
    - Be accessible: Associate errors with fields via aria-describedby
    
    Example Messages:
    - "Activity name is required"
    - "Activity name cannot exceed 100 characters"
    - "Cannot log activities with future dates"
    - "Duration must be between 1 minute and 24 hours"
    - "Please select an energy level (1-4)"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 5: TESTING STRATEGY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5.1 Unit Tests (energy_tracker/tests.py)
    
    Model Tests:
    - test_activity_creation_with_duration
    - test_duration_validation_min_max
    - test_energy_level_choices_1_to_4
    - test_activity_name_max_length_100
    - test_get_duration_display_formatting
    
    Form Tests:
    - test_activity_form_valid_data
    - test_activity_form_future_date_invalid
    - test_duration_too_short_invalid
    - test_duration_too_long_invalid
    - test_activity_name_too_long_invalid
    - test_energy_level_required
    - test_duration_hours_minutes_conversion
    
    Utility Tests (if utils.py created):
    - test_canonical_name_returns_most_common_casing
    - test_canonical_name_new_activity_returns_input
    - test_canonical_name_case_insensitive_match

5.2 Integration Tests
    
    View Tests:
    - test_log_activity_get_authenticated
    - test_log_activity_post_valid_creates_activity
    - test_log_activity_post_invalid_shows_errors
    - test_log_activity_unauthenticated_redirects
    - test_autocomplete_returns_top_5_frequent
    - test_autocomplete_filters_by_search_term
    - test_autocomplete_empty_for_new_user
    
    End-to-End Tests:
    - test_complete_activity_logging_flow
    - test_duplicate_name_consolidation
    - test_overlapping_activities_allowed

5.3 Manual Testing Checklist
    
    Functionality:
    â–¡ Autocomplete shows top 5 frequent activities
    â–¡ Autocomplete filters as user types
    â–¡ Can select from autocomplete or type new name
    â–¡ Date/time picker defaults to now
    â–¡ Cannot select future date/time
    â–¡ Duration validates min 1 min, max 24 hours
    â–¡ Energy buttons visually indicate selection
    â–¡ Clear form resets all fields
    â–¡ Success message displays after save
    â–¡ Activity saves to database with correct values
    
    Validation:
    â–¡ Future date shows error
    â–¡ Duration 0h 0m shows error
    â–¡ Duration > 24h shows error
    â–¡ Empty activity name shows error
    â–¡ Activity name > 100 chars shows error
    â–¡ No energy level selected shows error
    
    UX/UI:
    â–¡ Form is responsive on mobile
    â–¡ Autocomplete dropdown positions correctly
    â–¡ Circular buttons are touch-friendly
    â–¡ Error messages are clear and helpful
    â–¡ Success modal appears and dismisses
    
    Accessibility:
    â–¡ All form fields have labels
    â–¡ Keyboard navigation works
    â–¡ Screen reader announces errors
    â–¡ Color contrast meets WCAG AA
    â–¡ Focus indicators visible

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 6: DEPLOYMENT & MIGRATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 Pre-Deployment Checklist
    
    â–¡ All tests passing (python manage.py test energy_tracker)
    â–¡ Migrations created and tested
    â–¡ Data migration script tested on copy of production data
    â–¡ Rollback plan documented
    â–¡ Performance tested with large datasets (1000+ activities)
    â–¡ Cross-browser testing (Chrome, Firefox, Safari, Edge)
    â–¡ Mobile testing (iOS Safari, Android Chrome)

6.2 Deployment Steps
    
    1. Backup production database
    2. Deploy new code to staging environment
    3. Run migrations on staging
    4. Smoke test on staging
    5. Deploy to production (off-peak hours if possible)
    6. Run migrations on production
    7. Monitor for errors in first 24 hours
    8. Rollback if critical issues found

6.3 Data Migration Considerations
    
    Energy Level Transformation:
    - Old scale: -2, -1, 0, 1, 2
    - New scale: 1, 2, 3, 4 (no neutral option)
    - Mapping:
      - -2 â†’ 1 (Very Draining)
      - -1 â†’ 2 (Somewhat Draining)
      - 0 â†’ 2 or 3 (decision: map to 2 to be conservative)
      - 1 â†’ 3 (Somewhat Energizing)
      - 2 â†’ 4 (Very Energizing)
    
    Duration Default:
    - Set all existing activities to 60 minutes (1 hour)
    - Add note in release notes that historical durations are estimates
    
    Activity Names:
    - Run one-time script to consolidate duplicate casings
    - Log changes for user notification if desired

6.4 Post-Deployment Monitoring
    
    Metrics to Track:
    - Activity creation success rate
    - Autocomplete API response time
    - Database query performance
    - Error rate (client and server)
    - User adoption of new features
    
    Alerts:
    - API response time > 500ms
    - Error rate > 1%
    - Database queries > 100ms

================================================================================
FILES TO CREATE/MODIFY
================================================================================

NEW FILES:
â–¡ energy_tracker/utils.py â€” Activity name normalization helper

MODIFIED FILES:
â–¡ energy_tracker/models.py â€” Add duration, update energy_level, update name max_length
â–¡ energy_tracker/forms.py â€” Add duration fields, update validation, remove description
â–¡ energy_tracker/views.py â€” Add autocomplete endpoint, update log_activity_view
â–¡ energy_tracker/urls.py â€” Add autocomplete URL route
â–¡ templates/energy_tracker/log_activity.html â€” **COMPLETE REWRITE** (no code reuse from existing)
â–¡ energy_tracker/tests.py â€” Add comprehensive test coverage

MIGRATIONS:
â–¡ XXXX_add_duration_and_update_energy.py â€” Schema changes
â–¡ XXXX_migrate_energy_level_data.py â€” Data transformation migration

STATIC FILES (if needed):
â–¡ None - All CSS uses Tailwind utility classes
â–¡ All JavaScript is inline in the template (no separate JS files needed)
â–¡ No custom CSS files required - complete styling with Tailwind

================================================================================
IMPLEMENTATION TIMELINE
================================================================================

Phase 1 - Database & Models: 2 hours
- Update models
- Create migrations
- Test migrations

Phase 2 - Backend Logic: 3 hours
- Update forms
- Create utils.py
- Add autocomplete endpoint
- Update log_activity_view

Phase 3 - Frontend: 4 hours
- **COMPLETE REWRITE** of log_activity.html template
- Delete all existing HTML, CSS, and JavaScript
- Build new clean semantic HTML structure from scratch
- Implement autocomplete with vanilla JavaScript (no code reuse)
- Implement circular energy buttons with new design
- Add clear form functionality
- Add success modal
- Use only Tailwind CSS (no custom CSS files)
- All JavaScript inline in template (no external files)

Phase 4 - Validation: 2 hours
- Client-side validation
- Server-side validation
- Error message refinement

Phase 5 - Testing: 3 hours
- Write unit tests
- Write integration tests
- Manual testing
- Fix bugs

Phase 6 - Deployment: 2 hours
- Staging deployment
- Production deployment
- Monitoring

TOTAL ESTIMATED TIME: 16 hours

================================================================================
RISKS & MITIGATIONS
================================================================================

Risk 1: Data Migration Fails
Severity: High
Mitigation: Test on copy of production data; Have rollback script ready

Risk 2: Autocomplete Performance Issues
Severity: Medium
Mitigation: Implement caching; Add database indexes; Limit query results

Risk 3: User Confusion with New Energy Scale
Severity: Medium
Mitigation: Add onboarding tooltip; Document in help section; Monitor support tickets

Risk 4: Browser Compatibility Issues
Severity: Low
Mitigation: Test on all major browsers; Use progressive enhancement

Risk 5: Accessibility Regressions
Severity: Medium
Mitigation: Test with screen reader; Use ARIA attributes; Follow WCAG guidelines

================================================================================
SUCCESS METRICS
================================================================================

Technical Metrics:
- All automated tests passing (100% pass rate)
- Code coverage > 80% for new/modified code
- Autocomplete API response time < 200ms (p95)
- Page load time < 2 seconds
- Zero critical bugs in first week

User Experience Metrics:
- Activity logging success rate > 95%
- Average time to log activity < 30 seconds
- User satisfaction rating > 4/5 (if surveyed)
- Support tickets related to log activity < 5 per week

Business Metrics:
- Daily active users maintain or increase
- Activities logged per user maintains or increases
- Feature adoption rate > 80% within first month

================================================================================
FUTURE ENHANCEMENTS (Out of Scope)
================================================================================

- Activity templates/favorites for one-click logging
- Bulk import of activities from calendar
- Activity categories/tags
- Recurring activities
- Activity recommendations based on time of day
- Mobile app with offline support
- Integration with wearables (Fitbit, Apple Watch)

================================================================================
DOCUMENTATION UPDATES NEEDED
================================================================================

â–¡ README.md â€” Update feature description
â–¡ User Guide â€” Add "How to Log an Activity" section
â–¡ API Documentation â€” Document autocomplete endpoint
â–¡ Developer Guide â€” Document activity name normalization logic
â–¡ Release Notes â€” Describe changes and migration impact

================================================================================
APPROVAL & SIGN-OFF
================================================================================

Technical Lead: _______________  Date: _______________
Product Owner: _______________  Date: _______________
QA Lead: _______________  Date: _______________

================================================================================
END OF IMPLEMENTATION PLAN
================================================================================
